<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EduRock AI Study Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">
  <div class="container mx-auto p-6 max-w-3xl">
    <h1 class="text-4xl font-bold text-green-400 text-center mb-8">EduRock - AI Study Assistant</h1>

    <!-- Upload Section -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-md text-center">
      <input type="file" id="pdfFile" accept="application/pdf" class="mb-4 w-full text-white"/>
      <button onclick="handlePDF()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
        Upload and Summarize
      </button>
    </div>

    <!-- Summary Output -->
    <div id="summaryOutput" class="mt-8 space-y-6"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    const OPENAI_API_KEY = "YOUR_API_KEY_HERE"; // Replace this with your actual API key

    async function handlePDF() {
      const fileInput = document.getElementById('pdfFile');
      const file = fileInput.files[0];
      if (!file || file.type !== "application/pdf") return alert("Please upload a valid PDF file.");

      const reader = new FileReader();
      reader.onload = async function () {
        const typedArray = new Uint8Array(this.result);
        const pdf = await pdfjsLib.getDocument(typedArray).promise;
        const outputDiv = document.getElementById('summaryOutput');
        outputDiv.innerHTML = "";

        for (let i = 1; i <= pdf.numPages && i <= 5; i++) { // limit to 5 pages for now
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(" ");

          const summary = await summarizeText(pageText);

          outputDiv.innerHTML += `
            <div class="bg-gray-800 p-4 rounded shadow">
              <h2 class="text-lg font-bold text-green-300 mb-2">Summary for Page ${i}</h2>
              <p class="text-gray-300">${summary}</p>
              <a href="test.html?page=${i}" class="text-green-400 underline mt-2 inline-block">Generate Test âž”</a>
            </div>
          `;
        }
      };
      reader.readAsArrayBuffer(file);
    }

    async function summarizeText(text) {
      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{
              role: "user",
              content: `Please summarize this for studying:\n\n${text}`
            }],
            temperature: 0.5
          })
        });

        const data = await response.json();
        return data.choices?.[0]?.message?.content?.trim() || "Summary not available.";
      } catch (err) {
        console.error(err);
        return "Error summarizing this page.";
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'AdihausDIN';
            src: url('https://www.adidas.com/static/fonts/adihausdin-bold.woff2');
        }
        .font-adidas { font-family: 'AdihausDIN', sans-serif; }
        .drop-zone {
            border: 2px dashed #48BB78;
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            background-color: #2D3748;
            border-color: #68D391;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-adidas mb-6 text-green-400">AI Study Assistant</h1>
            
            <!-- File Upload Container -->
            <div class="drop-zone rounded-xl p-8 cursor-pointer" 
                 id="dropZone"
                 ondragover="handleDragOver(event)"
                 ondragleave="handleDragLeave(event)"
                 ondrop="handleDrop(event)">
                <input type="file" id="fileInput" accept=".pdf" class="hidden">
                <p class="text-xl">Click to upload PDF or drag and drop</p>
                <p class="text-sm mt-2 text-gray-400">(Supports PDF documents up to 200 pages)</p>
            </div>
        </header>

        <!-- Content Sections -->
        <div id="content">
            <!-- Summaries Section -->
            <section id="summaries" class="space-y-6 mb-12">
                <div id="summaryOutput" class="bg-gray-800 p-6 rounded-lg text-gray-300"></div>
            </section>

            <!-- Test Section -->
            <section id="test" class="hidden">
                <!-- Test logic will be added here -->
            </section>
        </div>

        <!-- Loading Overlay -->
        <div id="loading" class="fixed inset-0 bg-gray-900/90 hidden items-center justify-center">
            <div class="text-green-400 text-xl animate-pulse">Processing Document...</div>
        </div>
    </div>

    <script>
        const apiKey = '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'; // Replace with your actual API key

        // Event Handlers
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        document.getElementById('dropZone').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        async function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) handleFile(file);
        }

        async function handleFile(file) {
            try {
                // Validate file
                if (!file.type.includes('pdf')) {
                    throw new Error('Only PDF files are supported');
                }

                showLoading();
                const pdfText = await extractTextFromPDF(file);
                const summary = await summarizeText(pdfText);
                displaySummary(summary);
            } catch (error) {
                alert(error.message);
            } finally {
                hideLoading();
            }
        }

        async function extractTextFromPDF(file) {
            const pdfData = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
            const textPages = [];

            for (let i = 1; i <= Math.min(pdf.numPages, 200); i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                textPages.push(content.items.map(item => item.str).join(' '));
            }

            return textPages.join(' ');
        }

        async function summarizeText(text) {
            const url = 'https://api.openai.com/v1/completions'; // OpenAI's completion endpoint

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`,
            };

            const body = JSON.stringify({
                model: 'gpt-3.5-turbo',
                prompt: `Summarize this text: ${text}`,
                max_tokens: 300,
            });

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: body,
                });

                const data = await response.json();
                return data.choices[0]?.text.trim() || 'Summary unavailable.';
            } catch (error) {
                console.error('Error summarizing text:', error);
                return 'Summary unavailable.';
            }
        }

        function displaySummary(summary) {
            const container = document.getElementById('summaryOutput');
            container.textContent = summary;
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
    </script>
</body>
</html>
